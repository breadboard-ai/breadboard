import { base, recipe } from "@google-labs/breadboard";

import { starter } from "@google-labs/llm-starter";
import { core } from "@google-labs/core-kit";

/*
To run this: npx breadboard run .generativelanguage.models.generateText.js --kit @google-labs/core-kit --kit @google-labs/llm-starter -i "{ \"api_inputs\": {
      \"key\": \"${GEMINI_API_KEY}\",
      \"modelsId\": \"gemini-pro\",
      \"application/json\": {
        \"text\":
          \"Hello, my name is Paul and I'm not a large language model. I'm a real boy.\",
        \"model\": \"gemini-pro\"
      }
    }
}"
*/

const metaData = {
  title: "Generate Text",
  description: "Generates Text from Gemini (Generated by OpenAPI recipe)",
  version: "0.0.3",
};

/*
 Note currently the tool to generate the OpenAPI spec does not support the security Scheme, therefore secrets will not work, you have to use an input called key.
*/
export default await recipe(() => {
  const input = base.input({ $id: "input" });

  return core.invoke({
    path: "./spec/generativelanguage.models.generateText.json",
    input: input.api_inputs,
    ...input,
    ...starter.secrets({ keys: ["GEMINI_API_KEY"] }),
  });
}).serialize(metaData);
