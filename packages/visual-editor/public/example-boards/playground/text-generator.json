{
  "title": "Text Generator",
  "description": "This is a text generator. It can generate text using various LLMs. Currently, it supports the following models: Google Gemini Pro and OpenAI GPT-3.5 Turbo.",
  "version": "0.1.0",
  "edges": [
    {
      "from": "input-0",
      "to": "llm-response",
      "out": "text",
      "in": "text"
    },
    {
      "from": "input-0",
      "to": "runJavascript-0",
      "out": "model",
      "in": "model"
    },
    {
      "from": "llm-response",
      "to": "output-0",
      "out": "text",
      "in": "textOutput"
    },
    {
      "from": "runJavascript-0",
      "to": "llm-response",
      "out": "board",
      "in": "$board"
    },
    {
      "from": "runJavascript-0",
      "to": "llm-response",
      "out": "model",
      "in": "model"
    }
  ],
  "nodes": [
    {
      "id": "input-0",
      "type": "input",
      "configuration": {
        "schema": {
          "type": "object",
          "properties": {
            "model": {
              "type": "string",
              "enum": [
                "Gemini Pro",
                "GPT 3.5 Turbo"
              ]
            },
            "text": {
              "type": "string",
              "title": "Text",
              "description": "The text to generate"
            }
          },
          "required": [
            "model",
            "text"
          ]
        }
      }
    },
    {
      "id": "output-0",
      "type": "output",
      "configuration": {
        "schema": {
          "type": "object",
          "properties": {
            "textOutput": {
              "type": [
                "array",
                "boolean",
                "null",
                "number",
                "object",
                "string"
              ],
              "title": "Text",
              "description": "The generated text"
            }
          },
          "required": [
            "textOutput"
          ]
        }
      }
    },
    {
      "id": "llm-response",
      "type": "invoke",
      "configuration": {}
    },
    {
      "id": "runJavascript-0",
      "type": "runJavascript",
      "configuration": {
        "code": "const run = ({model:model2,serialized})=>{if(model2==\"Gemini Pro\"){return{board:{kind:\"board\",board:JSON.parse(serialized)},model:\"gemini-1.5-pro-latest\"}}else{return{board:{kind:\"board\",path:\"openai-gpt-35-turbo.json\"},model:\"N/A\"}}};",
        "inputSchema": {
          "type": "object",
          "properties": {
            "model": {
              "type": "string",
              "enum": [
                "Gemini Pro",
                "GPT 3.5 Turbo"
              ]
            },
            "serialized": {
              "type": "string"
            }
          }
        },
        "name": "run",
        "outputSchema": {
          "type": "object",
          "properties": {
            "board": {
              "type": "object",
              "anyOf": [
                {
                  "type": "object",
                  "properties": {
                    "kind": {
                      "type": "string"
                    },
                    "board": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "board"
                  ],
                  "additionalProperties": false
                },
                {
                  "type": "object",
                  "properties": {
                    "kind": {
                      "type": "string"
                    },
                    "path": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "path"
                  ],
                  "additionalProperties": false
                }
              ]
            },
            "model": {
              "type": "string"
            }
          }
        },
        "raw": true,
        "serialized": "{\"title\":\"Gemini Generator\",\"description\":\"Generates text using the Gemini API.\",\"version\":\"0.1.0\",\"metadata\":{\"help\":{\"url\":\"https://breadboard-ai.github.io/breadboard/docs/kits/gemini/#the-text-component\"}},\"edges\":[{\"from\":\"choose-method\",\"to\":\"make-url\",\"out\":\"method\",\"in\":\"method\"},{\"from\":\"choose-method\",\"to\":\"make-url\",\"out\":\"sseOption\",\"in\":\"sseOption\"},{\"from\":\"collect-errors\",\"to\":\"count-retries\",\"out\":\"error\",\"in\":\"error\"},{\"from\":\"collect-errors\",\"to\":\"count-retries\",\"out\":\"retry\",\"in\":\"retry\"},{\"from\":\"count-retries\",\"to\":\"collect-errors\",\"out\":\"retry\",\"in\":\"retry\"},{\"from\":\"count-retries\",\"to\":\"make-body\",\"out\":\"context\",\"in\":\"context\"},{\"from\":\"count-retries\",\"to\":\"make-body\",\"out\":\"model\",\"in\":\"model\"},{\"from\":\"count-retries\",\"to\":\"make-body\",\"out\":\"responseMimeType\",\"in\":\"responseMimeType\"},{\"from\":\"count-retries\",\"to\":\"make-body\",\"out\":\"safetySettings\",\"in\":\"safetySettings\"},{\"from\":\"count-retries\",\"to\":\"make-body\",\"out\":\"stopSequences\",\"in\":\"stopSequences\"},{\"from\":\"count-retries\",\"to\":\"make-body\",\"out\":\"systemInstruction\",\"in\":\"systemInstruction\"},{\"from\":\"count-retries\",\"to\":\"make-body\",\"out\":\"text\",\"in\":\"text\"},{\"from\":\"count-retries\",\"to\":\"make-body\",\"out\":\"tools\",\"in\":\"tools\"},{\"from\":\"fetch-gemini-api\",\"to\":\"collect-errors\",\"out\":\"$error\",\"in\":\"error\"},{\"from\":\"fetch-gemini-api\",\"to\":\"format-response\",\"out\":\"response\",\"in\":\"response\"},{\"from\":\"format-response\",\"to\":\"collect-errors\",\"out\":\"$error\",\"in\":\"error\"},{\"from\":\"format-response\",\"to\":\"content-output\",\"out\":\"context\",\"in\":\"context\"},{\"from\":\"format-response\",\"to\":\"content-output\",\"out\":\"text\",\"in\":\"text\"},{\"from\":\"format-response\",\"to\":\"tool-call-output\",\"out\":\"context\",\"in\":\"context\"},{\"from\":\"GEMINI_KEY-secret\",\"to\":\"make-url\",\"out\":\"GEMINI_KEY\",\"in\":\"GEMINI_KEY\"},{\"from\":\"inputs\",\"to\":\"choose-method\",\"out\":\"useStreaming\",\"in\":\"useStreaming\"},{\"from\":\"inputs\",\"to\":\"count-retries\",\"out\":\"context\",\"in\":\"context\",\"constant\":true},{\"from\":\"inputs\",\"to\":\"count-retries\",\"out\":\"model\",\"in\":\"model\",\"constant\":true},{\"from\":\"inputs\",\"to\":\"count-retries\",\"out\":\"responseMimeType\",\"in\":\"responseMimeType\",\"constant\":true},{\"from\":\"inputs\",\"to\":\"count-retries\",\"out\":\"retry\",\"in\":\"retry\"},{\"from\":\"inputs\",\"to\":\"count-retries\",\"out\":\"safetySettings\",\"in\":\"safetySettings\",\"constant\":true},{\"from\":\"inputs\",\"to\":\"count-retries\",\"out\":\"stopSequences\",\"in\":\"stopSequences\",\"constant\":true},{\"from\":\"inputs\",\"to\":\"count-retries\",\"out\":\"systemInstruction\",\"in\":\"systemInstruction\",\"constant\":true},{\"from\":\"inputs\",\"to\":\"count-retries\",\"out\":\"text\",\"in\":\"text\",\"constant\":true},{\"from\":\"inputs\",\"to\":\"count-retries\",\"out\":\"tools\",\"in\":\"tools\",\"constant\":true},{\"from\":\"inputs\",\"to\":\"make-url\",\"out\":\"model\",\"in\":\"model\"},{\"from\":\"make-body\",\"to\":\"fetch-gemini-api\",\"out\":\"result\",\"in\":\"body\"},{\"from\":\"make-url\",\"to\":\"fetch-gemini-api\",\"out\":\"url\",\"in\":\"url\",\"constant\":true}],\"nodes\":[{\"id\":\"inputs\",\"type\":\"input\",\"configuration\":{\"schema\":{\"type\":\"object\",\"properties\":{\"context\":{\"type\":\"array\",\"title\":\"Context\",\"description\":\"An array of messages to use as conversation context\",\"default\":\"[]\",\"items\":{\"type\":\"object\",\"properties\":{\"role\":{\"type\":\"string\",\"enum\":[\"model\",\"user\",\"tool\",\"$metadata\"]},\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"inlineData\":{\"type\":\"object\",\"properties\":{\"mimeType\":{\"type\":\"string\",\"enum\":[\"image/png\",\"image/jpeg\",\"image/heic\",\"image/heif\",\"image/webp\"]},\"data\":{\"type\":\"string\"}},\"required\":[\"mimeType\",\"data\"],\"additionalProperties\":false}},\"required\":[\"inlineData\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_call\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"args\":{\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":{\"type\":\"string\"}}},\"required\":[\"name\",\"args\"],\"additionalProperties\":false}},\"required\":[\"function_call\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_response\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"response\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"name\",\"response\"],\"additionalProperties\":false}},\"required\":[\"function_response\"],\"additionalProperties\":false}]}}},\"required\":[\"role\",\"parts\"],\"additionalProperties\":false,\"behavior\":[\"llm-content\"]}},\"model\":{\"type\":\"string\",\"behavior\":[\"config\"],\"title\":\"Model\",\"description\":\"The model to use for generation\",\"default\":\"gemini-1.5-flash-latest\",\"examples\":[\"gemini-1.5-flash-latest\"],\"enum\":[\"gemini-1.5-flash-latest\",\"gemini-1.5-pro-latest\",\"gemini-2.0-flash-exp\",\"gemini-2.0-flash-thinking-exp\",\"gemini-exp-1206\",\"gemini-exp-1121\",\"learnlm-1.5-pro-experimental\",\"gemini-1.5-pro-001\",\"gemini-1.5-pro-002\",\"gemini-1.5-pro-exp-0801\",\"gemini-1.5-pro-exp-0827\",\"gemini-1.5-flash-001\",\"gemini-1.5-flash-002\",\"gemini-1.5-flash-8b-exp-0924\",\"gemini-1.5-flash-8b-exp-0827\",\"gemini-1.5-flash-exp-0827\"]},\"responseMimeType\":{\"type\":\"string\",\"behavior\":[\"config\"],\"title\":\"Response MIME Type\",\"description\":\"Output response mimetype of the generated text.\",\"default\":\"text/plain\",\"examples\":[\"text/plain\"],\"enum\":[\"text/plain\",\"application/json\"]},\"retry\":{\"type\":\"number\",\"behavior\":[\"config\"],\"title\":\"Retry Count\",\"description\":\"The number of times to retry the LLM call in case of failure\",\"default\":\"1\"},\"safetySettings\":{\"type\":\"array\",\"behavior\":[\"config\"],\"title\":\"Safety Settings\",\"description\":\"The safety settings object (see https://ai.google.dev/api/rest/v1beta/SafetySetting for more information)\",\"default\":\"[]\",\"items\":{\"type\":\"object\",\"properties\":{\"category\":{\"type\":\"string\"},\"threshold\":{\"type\":\"string\"}},\"required\":[\"category\",\"threshold\"],\"additionalProperties\":false}},\"stopSequences\":{\"type\":\"array\",\"behavior\":[\"config\"],\"title\":\"Stop Sequences\",\"description\":\"An array of strings that will stop the output\",\"default\":\"[]\",\"items\":{\"type\":\"string\"}},\"systemInstruction\":{\"behavior\":[\"config\"],\"title\":\"System Instruction\",\"description\":\"Give the model additional context to understand the task, provide more customized responses, and adhere to specific guidelines over the full user interaction.\",\"default\":\"\",\"anyOf\":[{\"type\":\"string\"},{\"type\":\"object\",\"properties\":{\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"inlineData\":{\"type\":\"object\",\"properties\":{\"mimeType\":{\"type\":\"string\",\"enum\":[\"image/png\",\"image/jpeg\",\"image/heic\",\"image/heif\",\"image/webp\"]},\"data\":{\"type\":\"string\"}},\"required\":[\"mimeType\",\"data\"],\"additionalProperties\":false}},\"required\":[\"inlineData\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_call\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"args\":{\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":{\"type\":\"string\"}}},\"required\":[\"name\",\"args\"],\"additionalProperties\":false}},\"required\":[\"function_call\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_response\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"response\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"name\",\"response\"],\"additionalProperties\":false}},\"required\":[\"function_response\"],\"additionalProperties\":false}]}}},\"required\":[\"parts\"],\"additionalProperties\":false}]},\"text\":{\"type\":\"string\",\"title\":\"Text\",\"description\":\"The text to generate\",\"default\":\"\"},\"tools\":{\"type\":\"array\",\"title\":\"Tools\",\"description\":\"An array of functions to use for tool-calling\",\"default\":\"[]\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"parameters\":{\"type\":\"object\"}},\"required\":[\"name\",\"description\",\"parameters\"],\"additionalProperties\":false}},\"useStreaming\":{\"type\":\"boolean\",\"behavior\":[\"deprecated\"],\"title\":\"Stream Output\",\"description\":\"Whether to stream the output\",\"default\":\"false\"}},\"required\":[]}},\"metadata\":{\"title\":\"Input Parameters\",\"description\":\"Collecting input parameters\"}},{\"id\":\"content-output\",\"type\":\"output\",\"configuration\":{\"schema\":{\"type\":\"object\",\"properties\":{\"context\":{\"type\":\"object\",\"properties\":{\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"functionCall\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"functionCall\"],\"additionalProperties\":false}]}}},\"required\":[\"parts\"],\"additionalProperties\":false,\"title\":\"Context\",\"description\":\"The conversation context\"},\"text\":{\"type\":\"string\",\"title\":\"Text\",\"description\":\"The generated text\"}},\"required\":[\"context\",\"text\"]}},\"metadata\":{\"title\":\"Content Output\",\"description\":\"Outputting content\"}},{\"id\":\"tool-call-output\",\"type\":\"output\",\"configuration\":{\"schema\":{\"type\":\"object\",\"properties\":{\"context\":{\"type\":\"object\",\"properties\":{\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"functionCall\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"functionCall\"],\"additionalProperties\":false}]}}},\"required\":[\"parts\"],\"additionalProperties\":false,\"title\":\"Context\",\"description\":\"The conversation context\"}},\"required\":[\"context\"]}},\"metadata\":{\"title\":\"Tool Call Output\",\"description\":\"Outputting a tool call\"}},{\"id\":\"choose-method\",\"type\":\"runJavascript\",\"configuration\":{\"code\":\"const choose_method = ({ useStreaming }) => {\\n    const method = useStreaming ? \\\"streamGenerateContent\\\" : \\\"generateContent\\\";\\n    const sseOption = useStreaming ? \\\"&alt=sse\\\" : \\\"\\\";\\n    return { method, sseOption };\\n};\",\"inputSchema\":{\"type\":\"object\",\"properties\":{\"useStreaming\":{\"type\":\"boolean\",\"behavior\":[\"deprecated\"]}}},\"name\":\"choose_method\",\"outputSchema\":{\"type\":\"object\",\"properties\":{\"method\":{\"type\":\"string\",\"enum\":[\"streamGenerateContent\",\"generateContent\"]},\"sseOption\":{\"type\":\"string\"}}},\"raw\":true},\"metadata\":{\"title\":\"Choose Method\",\"description\":\"Choosing the right Gemini API method\"}},{\"id\":\"collect-errors\",\"type\":\"passthrough\",\"configuration\":{},\"metadata\":{\"title\":\"Collect Errors\",\"description\":\"Collecting the error from Gemini API\"}},{\"id\":\"count-retries\",\"type\":\"runJavascript\",\"configuration\":{\"code\":\"const count_retries = ({ retry, error, ...rest }) => {\\n    retry = retry || 0;\\n    let errorResponse = {};\\n    try {\\n        errorResponse = JSON.parse(error?.error?.message || \\\"null\\\");\\n    }\\n    catch (e) {\\n        // Ignore the error\\n    }\\n    const errorCode = errorResponse?.error?.code;\\n    if (errorCode) {\\n        // Retry won't help with 404, 429 or 400, because these are either the\\n        // caller's problem or in case of 429, retries are actually doing more harm\\n        // than good.\\n        const retryWontHelp = errorCode == 400 || errorCode == 429 || errorCode == 404;\\n        if (retryWontHelp) {\\n            // TODO(aomarks) We don't have `code` in the general $error type, and we\\n            // probably shouldn't since there are all kind of possible error shapes.\\n            // There should probably be a way to set the schema for $error to any\\n            // sub-type of the general one on a node-by-node basis. For now we just\\n            // cast to pretend `code` isn't there.\\n            return { $error: error };\\n        }\\n        // The \\\"-1\\\" value is something that responseFormatter sends when empty\\n        // response is encountered.\\n        if (errorCode == -1) {\\n            return { $error: error };\\n        }\\n    }\\n    if (retry < 0) {\\n        return {\\n            $error: `Gemini API retry failed: ${errorResponse.error?.code} ${errorResponse.error?.message}`,\\n        };\\n    }\\n    retry = retry - 1;\\n    return { ...rest, retry };\\n};\",\"error\":{},\"inputSchema\":{\"type\":\"object\",\"properties\":{\"context\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"role\":{\"type\":\"string\",\"enum\":[\"model\",\"user\",\"tool\",\"$metadata\"]},\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"inlineData\":{\"type\":\"object\",\"properties\":{\"mimeType\":{\"type\":\"string\",\"enum\":[\"image/png\",\"image/jpeg\",\"image/heic\",\"image/heif\",\"image/webp\"]},\"data\":{\"type\":\"string\"}},\"required\":[\"mimeType\",\"data\"],\"additionalProperties\":false}},\"required\":[\"inlineData\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_call\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"args\":{\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":{\"type\":\"string\"}}},\"required\":[\"name\",\"args\"],\"additionalProperties\":false}},\"required\":[\"function_call\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_response\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"response\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"name\",\"response\"],\"additionalProperties\":false}},\"required\":[\"function_response\"],\"additionalProperties\":false}]}}},\"required\":[\"role\",\"parts\"],\"additionalProperties\":false,\"behavior\":[\"llm-content\"]}},\"systemInstruction\":{\"anyOf\":[{\"type\":\"string\"},{\"type\":\"object\",\"properties\":{\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"inlineData\":{\"type\":\"object\",\"properties\":{\"mimeType\":{\"type\":\"string\",\"enum\":[\"image/png\",\"image/jpeg\",\"image/heic\",\"image/heif\",\"image/webp\"]},\"data\":{\"type\":\"string\"}},\"required\":[\"mimeType\",\"data\"],\"additionalProperties\":false}},\"required\":[\"inlineData\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_call\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"args\":{\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":{\"type\":\"string\"}}},\"required\":[\"name\",\"args\"],\"additionalProperties\":false}},\"required\":[\"function_call\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_response\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"response\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"name\",\"response\"],\"additionalProperties\":false}},\"required\":[\"function_response\"],\"additionalProperties\":false}]}}},\"required\":[\"parts\"],\"additionalProperties\":false}],\"behavior\":[\"config\"]},\"text\":{\"type\":\"string\"},\"model\":{\"type\":\"string\",\"enum\":[\"gemini-1.5-flash-latest\",\"gemini-1.5-pro-latest\",\"gemini-2.0-flash-exp\",\"gemini-2.0-flash-thinking-exp\",\"gemini-exp-1206\",\"gemini-exp-1121\",\"learnlm-1.5-pro-experimental\",\"gemini-1.5-pro-001\",\"gemini-1.5-pro-002\",\"gemini-1.5-pro-exp-0801\",\"gemini-1.5-pro-exp-0827\",\"gemini-1.5-flash-001\",\"gemini-1.5-flash-002\",\"gemini-1.5-flash-8b-exp-0924\",\"gemini-1.5-flash-8b-exp-0827\",\"gemini-1.5-flash-exp-0827\"],\"behavior\":[\"config\"]},\"tools\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"parameters\":{\"type\":\"object\"}},\"required\":[\"name\",\"description\",\"parameters\"],\"additionalProperties\":false}},\"safetySettings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"category\":{\"type\":\"string\"},\"threshold\":{\"type\":\"string\"}},\"required\":[\"category\",\"threshold\"],\"additionalProperties\":false},\"behavior\":[\"config\"]},\"stopSequences\":{\"type\":\"array\",\"items\":{\"type\":\"string\"},\"behavior\":[\"config\"]},\"responseMimeType\":{\"type\":\"string\",\"enum\":[\"text/plain\",\"application/json\"],\"behavior\":[\"config\"]},\"retry\":{\"type\":\"number\",\"anyOf\":[{\"type\":\"number\",\"behavior\":[\"config\"]},{\"type\":\"number\"}]},\"error\":{\"anyOf\":[{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]},{\"type\":\"object\",\"properties\":{\"error\":{\"type\":\"object\",\"properties\":{\"message\":{\"type\":\"string\"}},\"required\":[],\"additionalProperties\":false}},\"required\":[],\"additionalProperties\":false}]}}},\"name\":\"count_retries\",\"outputSchema\":{\"type\":\"object\",\"properties\":{\"context\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"role\":{\"type\":\"string\",\"enum\":[\"model\",\"user\",\"tool\",\"$metadata\"]},\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"inlineData\":{\"type\":\"object\",\"properties\":{\"mimeType\":{\"type\":\"string\",\"enum\":[\"image/png\",\"image/jpeg\",\"image/heic\",\"image/heif\",\"image/webp\"]},\"data\":{\"type\":\"string\"}},\"required\":[\"mimeType\",\"data\"],\"additionalProperties\":false}},\"required\":[\"inlineData\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_call\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"args\":{\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":{\"type\":\"string\"}}},\"required\":[\"name\",\"args\"],\"additionalProperties\":false}},\"required\":[\"function_call\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_response\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"response\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"name\",\"response\"],\"additionalProperties\":false}},\"required\":[\"function_response\"],\"additionalProperties\":false}]}}},\"required\":[\"role\",\"parts\"],\"additionalProperties\":false}},\"systemInstruction\":{\"anyOf\":[{\"type\":\"string\"},{\"type\":\"object\",\"properties\":{\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"inlineData\":{\"type\":\"object\",\"properties\":{\"mimeType\":{\"type\":\"string\",\"enum\":[\"image/png\",\"image/jpeg\",\"image/heic\",\"image/heif\",\"image/webp\"]},\"data\":{\"type\":\"string\"}},\"required\":[\"mimeType\",\"data\"],\"additionalProperties\":false}},\"required\":[\"inlineData\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_call\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"args\":{\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":{\"type\":\"string\"}}},\"required\":[\"name\",\"args\"],\"additionalProperties\":false}},\"required\":[\"function_call\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_response\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"response\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"name\",\"response\"],\"additionalProperties\":false}},\"required\":[\"function_response\"],\"additionalProperties\":false}]}}},\"required\":[\"parts\"],\"additionalProperties\":false}]},\"text\":{\"type\":\"string\"},\"model\":{\"type\":\"string\"},\"tools\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"parameters\":{\"type\":\"object\"}},\"required\":[\"name\",\"description\",\"parameters\"],\"additionalProperties\":false}},\"safetySettings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"category\":{\"type\":\"string\"},\"threshold\":{\"type\":\"string\"}},\"required\":[\"category\",\"threshold\"],\"additionalProperties\":false}},\"stopSequences\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"responseMimeType\":{\"type\":\"string\",\"enum\":[\"text/plain\",\"application/json\"]},\"retry\":{\"type\":\"number\"}}},\"raw\":true},\"metadata\":{\"title\":\"Check Retry Count\",\"description\":\"Making sure we can retry, if necessary.\"}},{\"id\":\"fetch-gemini-api\",\"type\":\"fetch\",\"configuration\":{\"method\":\"POST\"},\"metadata\":{\"title\":\"Make API Call\",\"description\":\"Calling Gemini API\"}},{\"id\":\"format-response\",\"type\":\"runJavascript\",\"configuration\":{\"code\":\"const format_response = ({ response }) => {\\n    const r = response;\\n    const context = r?.candidates?.[0].content;\\n    const firstPart = context?.parts?.[0];\\n    if (!firstPart) {\\n        return {\\n            $error: `No parts in response \\\"${JSON.stringify(response)}\\\" found`,\\n        };\\n    }\\n    if (\\\"text\\\" in firstPart) {\\n        return { text: firstPart.text, context };\\n    }\\n    else {\\n        return { context };\\n    }\\n};\",\"inputSchema\":{\"type\":\"object\",\"properties\":{\"response\":{\"type\":\"object\",\"properties\":{\"candidates\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"content\":{\"type\":\"object\",\"properties\":{\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"functionCall\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"functionCall\"],\"additionalProperties\":false}]}}},\"required\":[\"parts\"],\"additionalProperties\":false}},\"required\":[\"content\"],\"additionalProperties\":false}}},\"required\":[\"candidates\"],\"additionalProperties\":false}}},\"name\":\"format_response\",\"outputSchema\":{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"},\"context\":{\"type\":\"object\",\"properties\":{\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"functionCall\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"functionCall\"],\"additionalProperties\":false}]}}},\"required\":[\"parts\"],\"additionalProperties\":false}}},\"raw\":true},\"metadata\":{\"title\":\"Format Response\",\"description\":\"Formatting Gemini API response\"}},{\"id\":\"GEMINI_KEY-secret\",\"type\":\"secrets\",\"configuration\":{\"keys\":[\"GEMINI_KEY\"]}},{\"id\":\"make-body\",\"type\":\"runJavascript\",\"configuration\":{\"code\":\"const make_body = ({ context, systemInstruction, responseMimeType, text, model, tools, safetySettings, stopSequences, }) => {\\n    let contents = context;\\n    const olderModel = model === \\\"gemini-pro\\\" || model === \\\"gemini-ultra\\\";\\n    const turn = { role: \\\"user\\\", parts: [{ text }] };\\n    if (!contents || contents.length === 0) {\\n        if (text) {\\n            contents = [turn];\\n        }\\n        else {\\n            throw new Error(\\\"Either `text` or `context` parameter is required\\\");\\n        }\\n    }\\n    else {\\n        // Filter out the special \\\"$metadata\\\" role.\\n        contents = contents.filter((item) => item.role !== \\\"$metadata\\\");\\n        // Replace the \\\"tool\\\" role with \\\"user\\\".\\n        contents = contents.map((item) => item.role === \\\"tool\\\" ? ((item.role = \\\"user\\\"), item) : item);\\n        if (text) {\\n            // Add the user turn.\\n            contents.push(turn);\\n        }\\n        // Merge contiquous user turns.\\n        const merged = [];\\n        for (const item of contents) {\\n            const { role } = item;\\n            if (role === \\\"user\\\" && merged.at(-1)?.role === \\\"user\\\") {\\n                merged[merged.length - 1].parts.push(...item.parts);\\n            }\\n            else {\\n                merged.push(item);\\n            }\\n        }\\n        contents = merged;\\n    }\\n    const result = { contents };\\n    if (systemInstruction) {\\n        let parts;\\n        if (typeof systemInstruction === \\\"string\\\") {\\n            parts = [{ text: systemInstruction }];\\n        }\\n        else {\\n            parts = systemInstruction.parts;\\n            if (!parts || parts.length === 0) {\\n                throw new Error(`Malformed system instruction: ${JSON.stringify(systemInstruction)}`);\\n            }\\n        }\\n        if (olderModel) {\\n            contents[contents.length - 1].parts.unshift(...parts);\\n        }\\n        else {\\n            result.systemInstruction = { parts };\\n        }\\n    }\\n    if (safetySettings && !Object.keys(safetySettings).length) {\\n        result.safetySettings = [\\n            {\\n                category: \\\"HARM_CATEGORY_SEXUALLY_EXPLICIT\\\",\\n                threshold: \\\"BLOCK_NONE\\\",\\n            },\\n            {\\n                category: \\\"HARM_CATEGORY_HARASSMENT\\\",\\n                threshold: \\\"BLOCK_NONE\\\",\\n            },\\n            {\\n                category: \\\"HARM_CATEGORY_DANGEROUS_CONTENT\\\",\\n                threshold: \\\"BLOCK_NONE\\\",\\n            },\\n        ];\\n    }\\n    else {\\n        result.safetySettings = safetySettings;\\n    }\\n    const generationConfig = {};\\n    if (stopSequences && stopSequences.length > 0) {\\n        generationConfig.stopSequences = stopSequences;\\n    }\\n    if (responseMimeType) {\\n        generationConfig.responseMimeType = responseMimeType;\\n        if (responseMimeType === \\\"application/json\\\") {\\n            // Filter out any function calls in the context to avoid the 400 error.\\n            // Currently, gemini doesn't support function calls when the\\n            // responseMimeType is set to application/json.\\n            result.contents = contents.filter((item) => {\\n                if (item.role === \\\"model\\\") {\\n                    item.parts = item.parts.filter((part) => !(\\\"functionCall\\\" in part));\\n                    if (item.parts.length === 0) {\\n                        return false;\\n                    }\\n                }\\n                return true;\\n            });\\n        }\\n    }\\n    if (Object.keys(generationConfig).length > 0) {\\n        result.generationConfig = generationConfig;\\n    }\\n    if (tools && tools.length > 0) {\\n        result.tools = { function_declarations: tools };\\n    }\\n    return { result };\\n};\",\"inputSchema\":{\"type\":\"object\",\"properties\":{\"context\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"role\":{\"type\":\"string\",\"enum\":[\"model\",\"user\",\"tool\",\"$metadata\"]},\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"inlineData\":{\"type\":\"object\",\"properties\":{\"mimeType\":{\"type\":\"string\",\"enum\":[\"image/png\",\"image/jpeg\",\"image/heic\",\"image/heif\",\"image/webp\"]},\"data\":{\"type\":\"string\"}},\"required\":[\"mimeType\",\"data\"],\"additionalProperties\":false}},\"required\":[\"inlineData\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_call\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"args\":{\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":{\"type\":\"string\"}}},\"required\":[\"name\",\"args\"],\"additionalProperties\":false}},\"required\":[\"function_call\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_response\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"response\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"name\",\"response\"],\"additionalProperties\":false}},\"required\":[\"function_response\"],\"additionalProperties\":false}]}}},\"required\":[\"role\",\"parts\"],\"additionalProperties\":false}},\"systemInstruction\":{\"anyOf\":[{\"type\":\"string\"},{\"type\":\"object\",\"properties\":{\"parts\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"anyOf\":[{\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"}},\"required\":[\"text\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"inlineData\":{\"type\":\"object\",\"properties\":{\"mimeType\":{\"type\":\"string\",\"enum\":[\"image/png\",\"image/jpeg\",\"image/heic\",\"image/heif\",\"image/webp\"]},\"data\":{\"type\":\"string\"}},\"required\":[\"mimeType\",\"data\"],\"additionalProperties\":false}},\"required\":[\"inlineData\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_call\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"args\":{\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":{\"type\":\"string\"}}},\"required\":[\"name\",\"args\"],\"additionalProperties\":false}},\"required\":[\"function_call\"],\"additionalProperties\":false},{\"type\":\"object\",\"properties\":{\"function_response\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"response\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}},\"required\":[\"name\",\"response\"],\"additionalProperties\":false}},\"required\":[\"function_response\"],\"additionalProperties\":false}]}}},\"required\":[\"parts\"],\"additionalProperties\":false}]},\"text\":{\"type\":\"string\"},\"model\":{\"type\":\"string\"},\"tools\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"parameters\":{\"type\":\"object\"}},\"required\":[\"name\",\"description\",\"parameters\"],\"additionalProperties\":false}},\"safetySettings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"category\":{\"type\":\"string\"},\"threshold\":{\"type\":\"string\"}},\"required\":[\"category\",\"threshold\"],\"additionalProperties\":false}},\"stopSequences\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"responseMimeType\":{\"type\":\"string\",\"enum\":[\"text/plain\",\"application/json\"]}}},\"name\":\"make_body\",\"outputSchema\":{\"type\":\"object\",\"properties\":{\"result\":{\"type\":\"object\",\"properties\":{\"contents\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]},\"systemInstruction\":{\"type\":\"object\",\"properties\":{\"parts\":{\"type\":\"array\",\"items\":{\"type\":[\"array\",\"boolean\",\"null\",\"number\",\"object\",\"string\"]}}},\"required\":[\"parts\"],\"additionalProperties\":false},\"safetySettings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"category\":{\"type\":\"string\"},\"threshold\":{\"type\":\"string\"}},\"required\":[\"category\",\"threshold\"],\"additionalProperties\":false}},\"generationConfig\":{\"type\":\"object\",\"properties\":{\"stopSequences\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"responseMimeType\":{\"type\":\"string\",\"enum\":[\"text/plain\",\"application/json\"]}},\"required\":[],\"additionalProperties\":false},\"tools\":{\"type\":\"object\",\"properties\":{\"function_declarations\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"description\":{\"type\":\"string\"},\"parameters\":{\"type\":\"object\"}},\"required\":[\"name\",\"description\",\"parameters\"],\"additionalProperties\":false}}},\"required\":[\"function_declarations\"],\"additionalProperties\":false}},\"required\":[\"contents\"],\"additionalProperties\":false}}},\"raw\":true},\"metadata\":{\"title\":\"Make Request Body\"}},{\"id\":\"make-url\",\"type\":\"urlTemplate\",\"configuration\":{\"template\":\"https://generativelanguage.googleapis.com/v1beta/models/{model}:{method}?key={GEMINI_KEY}{+sseOption}\"},\"metadata\":{\"title\":\"Make URL\",\"description\":\"Creating the Gemini API URL\"}}]}"
      }
    }
  ]
}