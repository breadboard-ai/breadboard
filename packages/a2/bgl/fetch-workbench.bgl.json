{
  "title": "Fetch Workbench",
  "description": "",
  "version": "0.0.1",
  "nodes": [
    {
      "id": "input",
      "type": "input",
      "metadata": {
        "title": "Input"
      }
    },
    {
      "id": "run-module",
      "type": "runModule",
      "configuration": {
        "$module": "main"
      },
      "metadata": {
        "title": "Fetch Workbench"
      }
    },
    {
      "id": "output",
      "type": "output",
      "metadata": {
        "title": "Output"
      }
    }
  ],
  "edges": [
    {
      "from": "input",
      "to": "run-module",
      "out": "*",
      "in": ""
    },
    {
      "from": "run-module",
      "to": "output",
      "out": "*",
      "in": ""
    }
  ],
  "main": "main",
  "metadata": {
    "visual": {
      "presentation": {
        "themes": {
          "39239b49-62d0-4182-b919-924c4db67941": {
            "themeColors": {
              "primaryColor": "#246db5",
              "secondaryColor": "#5cadff",
              "backgroundColor": "#ffffff",
              "textColor": "#1a1a1a",
              "primaryTextColor": "#ffffff"
            },
            "template": "basic",
            "splashScreen": {
              "storedData": {
                "handle": "/images/app/generic-flow.jpg",
                "mimeType": "image/jpeg"
              }
            }
          }
        },
        "theme": "39239b49-62d0-4182-b919-924c4db67941"
      }
    },
    "userModified": true,
    "tags": [],
    "parameters": {}
  },
  "modules": {
    "main": {
      "code": "/**\n * @fileoverview Add a description for your module here.\n */\nimport fetch from \"@fetch\";\nimport read from \"@read\";\nimport output from \"@output\";\nfunction ok(o) {\n    return !(o && typeof o === \"object\" && \"$error\" in o);\n}\nexport { invoke as default, describe };\nexport { report };\nasync function report(inputs) {\n    const { actor: title, category: description, name, details, icon } = inputs;\n    const detailsSchema = typeof details === \"string\"\n        ? {\n            title: name,\n            type: \"string\",\n            format: \"markdown\",\n        }\n        : {\n            title: name,\n            type: \"object\",\n            behavior: [\"llm-content\"],\n        };\n    if (icon) {\n        detailsSchema.icon = icon;\n    }\n    const schema = {\n        type: \"object\",\n        properties: {\n            details: detailsSchema,\n        },\n    };\n    const { delivered } = await output({\n        $metadata: {\n            title,\n            description,\n            icon,\n        },\n        schema,\n        details,\n    });\n    return delivered;\n}\nasync function invoke({ endpoint }) {\n    const response = await fetch({\n        url: endpoint,\n        file: \"/run/saved\",\n        stream: \"json\",\n    });\n    if (!ok(response))\n        return response;\n    for (;;) {\n        const reading = await read({ path: response.response });\n        console.log(\"READING\", reading);\n        if (!ok(reading))\n            return reading;\n        if (\"done\" in reading && reading.done) {\n            return { result: \"done\" };\n        }\n        await report({\n            actor: \"Fetch\",\n            category: \"Streaming\",\n            name: \"Streaming OMG\",\n            details: reading.data?.at(-1) || \"none\",\n        });\n    }\n    return { result: \"done\" };\n}\nasync function describe() {\n    return {\n        inputSchema: {\n            type: \"object\",\n            properties: {\n                endpoint: {\n                    type: \"string\",\n                    title: \"Endpoint URL\",\n                    default: \"https://echo.free.beeceptor.com\",\n                },\n            },\n        },\n        outputSchema: {\n            type: \"object\",\n            properties: {\n                result: {\n                    type: \"object\",\n                    title: \"Result\",\n                },\n            },\n        },\n    };\n}\n",
      "metadata": {
        "title": "main",
        "source": {
          "code": "/**\n * @fileoverview Add a description for your module here.\n */\n\nimport fetch from \"@fetch\";\nimport read from \"@read\";\nimport output from \"@output\";\n\nexport type NonPromise<T> = T extends Promise<unknown> ? never : T;\n\nfunction ok<T>(o: Outcome<NonPromise<T>>): o is NonPromise<T> {\n  return !(o && typeof o === \"object\" && \"$error\" in o);\n}\nexport { invoke as default, describe };\n\ntype Inputs = {\n  endpoint: string;\n};\n\ntype Outputs = {\n  result: unknown;\n};\n\ntype ReportInputs = {\n  /**\n   * The name of the actor providing the report\n   */\n  actor: string;\n  /**\n   * The general category of the report\n   */\n  category: string;\n  /**\n   * The name of the report\n   */\n  name: string;\n  /**\n   * The details of the report\n   */\n  details: string | LLMContent;\n  /**\n   * The icon to use\n   */\n  icon?: string;\n};\n\nexport { report };\n\nasync function report(inputs: ReportInputs): Promise<boolean> {\n  const { actor: title, category: description, name, details, icon } = inputs;\n\n  const detailsSchema: Schema =\n    typeof details === \"string\"\n      ? {\n          title: name,\n          type: \"string\",\n          format: \"markdown\",\n        }\n      : {\n          title: name,\n          type: \"object\",\n          behavior: [\"llm-content\"],\n        };\n\n  if (icon) {\n    detailsSchema.icon = icon;\n  }\n\n  const schema: Schema = {\n    type: \"object\",\n    properties: {\n      details: detailsSchema,\n    },\n  };\n\n  const { delivered } = await output({\n    $metadata: {\n      title,\n      description,\n      icon,\n    },\n    schema,\n    details,\n  });\n  return delivered;\n}\n\nasync function invoke({ endpoint }: Inputs): Promise<Outcome<Outputs>> {\n  const response = await fetch({\n    url: endpoint,\n    file: \"/run/saved\",\n    stream: \"json\",\n  });\n  if (!ok(response)) return response;\n  for (;;) {\n    const reading = await read({ path: response.response as FileSystemPath });\n    console.log(\"READING\", reading);\n    if (!ok(reading)) return reading;\n    if (\"done\" in reading && reading.done) {\n      return { result: \"done\" };\n    }\n    await report({\n      actor: \"Fetch\",\n      category: \"Streaming\",\n      name: \"Streaming OMG\",\n      details: reading.data?.at(-1) || \"none\",\n    });\n  }\n  return { result: \"done\" };\n}\n\nasync function describe() {\n  return {\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        endpoint: {\n          type: \"string\",\n          title: \"Endpoint URL\",\n          default: \"https://echo.free.beeceptor.com\",\n        },\n      },\n    } satisfies Schema,\n    outputSchema: {\n      type: \"object\",\n      properties: {\n        result: {\n          type: \"object\",\n          title: \"Result\",\n        },\n      },\n    } satisfies Schema,\n  };\n}\n",
          "language": "typescript"
        },
        "description": "Add a description for your module here.",
        "runnable": true
      }
    }
  }
}