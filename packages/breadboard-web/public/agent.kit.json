{
  "title": "Agent Kit",
  "description": "A collection of nodes for building Agent-like experiences.",
  "version": "0.0.1",
  "url": "https://raw.githubusercontent.com/breadboard-ai/breadboard/main/packages/agent-kit/agent.kit.json",
  "nodes": {
    "human": {
      "title": "Human",
      "description": "A human in the loop. Use this node to insert a real person (user input) into your team of synthetic workers.",
      "version": "0.0.1",
      "edges": [
        {
          "from": "appendContext",
          "to": "output-2",
          "out": "context",
          "in": "context"
        },
        {
          "from": "input",
          "to": "appendContext",
          "out": "text",
          "in": "text"
        },
        {
          "from": "input",
          "to": "output-2",
          "out": "text",
          "in": "text"
        },
        {
          "from": "fn-4",
          "to": "input",
          "out": "schema",
          "in": "schema"
        },
        {
          "from": "fn-4",
          "to": "appendContext",
          "out": "context",
          "in": "context"
        },
        {
          "from": "input-1",
          "to": "fn-3",
          "out": "context",
          "in": "context"
        },
        {
          "from": "input-1",
          "to": "fn-4",
          "out": "title",
          "in": "title"
        },
        {
          "from": "input-1",
          "to": "fn-4",
          "out": "description",
          "in": "description"
        },
        {
          "from": "fn-3",
          "to": "fn-4",
          "out": "context",
          "in": "context"
        },
        {
          "from": "fn-3",
          "to": "output-5",
          "out": "output",
          "in": "output"
        }
      ],
      "nodes": [
        {
          "id": "output-2",
          "type": "output",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "type": "array",
                  "behavior": [
                    "llm-content"
                  ],
                  "title": "Context"
                },
                "text": {
                  "title": "Text",
                  "type": "string"
                }
              }
            }
          }
        },
        {
          "id": "appendContext",
          "type": "invoke",
          "configuration": {
            "$board": "#appendContext"
          }
        },
        {
          "id": "input",
          "type": "input",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "text": {
                  "title": "Text",
                  "type": "string"
                }
              },
              "required": [
                "text"
              ]
            }
          }
        },
        {
          "id": "fn-4",
          "type": "invoke",
          "configuration": {
            "$board": "#fn-4"
          },
          "metadata": {
            "title": "Create Schema",
            "description": "Create a schema for user input"
          }
        },
        {
          "id": "input-1",
          "type": "input",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "title": "Context",
                  "description": "Incoming conversation context",
                  "type": "array",
                  "behavior": [
                    "llm-content"
                  ],
                  "examples": [
                    "[]"
                  ],
                  "default": "[]"
                },
                "title": {
                  "title": "Title",
                  "description": "The title to ask",
                  "default": "User",
                  "type": "string"
                },
                "description": {
                  "title": "Description",
                  "description": "The description of what to ask",
                  "default": "User's question or request",
                  "type": "string"
                }
              },
              "required": []
            }
          }
        },
        {
          "id": "fn-3",
          "type": "invoke",
          "configuration": {
            "$board": "#fn-3"
          },
          "metadata": {
            "title": "Maybe Output",
            "description": "If the last message was from the model, output it"
          }
        },
        {
          "id": "output-5",
          "type": "output",
          "configuration": {
            "schema": {
              "type": "object",
              "behavior": [
                "bubble"
              ],
              "properties": {
                "output": {
                  "type": "string",
                  "title": "Output",
                  "description": "The output to display"
                }
              }
            }
          },
          "metadata": {
            "title": "Output",
            "description": "The output to display. This output will bubble up to the user."
          }
        }
      ],
      "graphs": {
        "appendContext": {
          "edges": [
            {
              "from": "appendContext-input",
              "to": "appendContext-run",
              "out": "*"
            },
            {
              "from": "appendContext-run",
              "to": "appendContext-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "appendContext-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "appendContext-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function appendContext({context,text}) {return{context:[...context||[],{role:\"user\",parts:[{text}]}]}}",
                "name": "appendContext",
                "raw": true
              }
            },
            {
              "id": "appendContext-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "fn-4": {
          "edges": [
            {
              "from": "fn-4-input",
              "to": "fn-4-run",
              "out": "*"
            },
            {
              "from": "fn-4-run",
              "to": "fn-4-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "fn-4-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "fn-4-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function fn_4({title,description,context}) {const schema2={type:\"object\",properties:{text:{title,description,behavior:[\"transient\"]}}};return{schema:schema2,context}}",
                "name": "fn_4",
                "raw": true
              }
            },
            {
              "id": "fn-4-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "fn-3": {
          "edges": [
            {
              "from": "fn-3-input",
              "to": "fn-3-run",
              "out": "*"
            },
            {
              "from": "fn-3-run",
              "to": "fn-3-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "fn-3-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "fn-3-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function fn_3({context}) {if(Array.isArray(context)&&context.length>0){const lastItem=context[context.length-1];if(lastItem.role===\"model\"){const output=lastItem.parts.map(item=>item.text).join(\"/n\");return{output,context}}}return{context}}",
                "name": "fn_3",
                "raw": true
              }
            },
            {
              "id": "fn-3-output",
              "type": "output",
              "configuration": {}
            }
          ]
        }
      }
    },
    "repeater": {
      "title": "Repeater",
      "description": "A worker whose job it is to repeat the same thing over and over, until some condition is met or the max count of repetitions is reached.",
      "version": "0.0.1",
      "edges": [
        {
          "from": "counter",
          "to": "invokeAgent",
          "out": "continue",
          "in": "context"
        },
        {
          "from": "counter",
          "to": "counter",
          "out": "count",
          "in": "count"
        },
        {
          "from": "counter",
          "to": "output-2",
          "out": "stop",
          "in": "context"
        },
        {
          "from": "invokeAgent",
          "to": "exit",
          "out": "exit",
          "in": "context"
        },
        {
          "from": "invokeAgent",
          "to": "counter",
          "out": "context",
          "in": "context"
        },
        {
          "from": "input-1",
          "to": "invokeAgent",
          "out": "worker",
          "in": "$board",
          "constant": true
        },
        {
          "from": "input-1",
          "to": "invokeAgent",
          "out": "context",
          "in": "context"
        },
        {
          "from": "input-1",
          "to": "counter",
          "out": "max",
          "in": "count"
        }
      ],
      "nodes": [
        {
          "id": "output-2",
          "type": "output",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "type": "string",
                  "title": "context"
                }
              }
            }
          }
        },
        {
          "id": "counter",
          "type": "invoke",
          "configuration": {
            "$board": "#counter"
          }
        },
        {
          "id": "invokeAgent",
          "type": "invoke",
          "configuration": {}
        },
        {
          "id": "input-1",
          "type": "input",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "worker": {
                  "title": "Worker",
                  "behavior": [
                    "board"
                  ],
                  "description": "Worker to repeat",
                  "type": "object"
                },
                "context": {
                  "title": "Context",
                  "type": "array",
                  "format": "multiline",
                  "behavior": [
                    "llm-content"
                  ],
                  "default": "[]",
                  "description": "Initial conversation context"
                },
                "max": {
                  "title": "Max",
                  "description": "The maximum number of repetitions to make (set to -1 to go infinitely)",
                  "type": "number",
                  "default": "-1",
                  "examples": [
                    "3"
                  ]
                }
              },
              "required": [
                "worker"
              ]
            }
          }
        },
        {
          "id": "exit",
          "type": "output",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "type": "string",
                  "title": "context"
                }
              }
            }
          }
        }
      ],
      "graphs": {
        "counter": {
          "edges": [
            {
              "from": "counter-input",
              "to": "counter-run",
              "out": "*"
            },
            {
              "from": "counter-run",
              "to": "counter-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "counter-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "counter-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function counter({context,count}) {const num=count-1;if(num!=0){return{continue:context,count:num}}return{stop:context}}",
                "name": "counter",
                "raw": true
              }
            },
            {
              "id": "counter-output",
              "type": "output",
              "configuration": {}
            }
          ]
        }
      }
    },
    "structuredWorker": {
      "title": "Structured Worker",
      "description": "A worker who outputs structure data (JSON) provided a schema.",
      "version": "0.0.1",
      "edges": [
        {
          "from": "assembleContext",
          "to": "output-2",
          "out": "context",
          "in": "context"
        },
        {
          "from": "validate",
          "to": "count",
          "out": "$error",
          "in": "error"
        },
        {
          "from": "validate",
          "to": "validationError",
          "out": "$error",
          "in": "$error"
        },
        {
          "from": "validate",
          "to": "assembleContext",
          "out": "json",
          "in": "json"
        },
        {
          "from": "validate",
          "to": "output-2",
          "out": "json",
          "in": "json"
        },
        {
          "from": "buildContext",
          "to": "count",
          "out": "context",
          "in": "context",
          "constant": true
        },
        {
          "from": "buildContext",
          "to": "assembleContext",
          "out": "context",
          "in": "context"
        },
        {
          "from": "generate",
          "to": "validate",
          "out": "text",
          "in": "json"
        },
        {
          "from": "input-1",
          "to": "schemish",
          "out": "schema",
          "in": "schema"
        },
        {
          "from": "input-1",
          "to": "buildContext",
          "out": "context",
          "in": "context"
        },
        {
          "from": "input-1",
          "to": "buildContext",
          "out": "instruction",
          "in": "instruction"
        },
        {
          "from": "input-1",
          "to": "validate",
          "out": "schema",
          "in": "schema",
          "constant": true
        },
        {
          "from": "count",
          "to": "count",
          "out": "count",
          "in": "count"
        },
        {
          "from": "count",
          "to": "generate",
          "out": "continue",
          "in": "context"
        },
        {
          "from": "count",
          "to": "validationError",
          "out": "stop",
          "in": "context"
        },
        {
          "from": "format",
          "to": "buildContext",
          "out": "prompt",
          "in": "format"
        },
        {
          "from": "schemish",
          "to": "format",
          "out": "schemish",
          "in": "schemish"
        },
        {
          "from": "initialValues",
          "to": "count",
          "out": "count",
          "in": "count"
        },
        {
          "from": "initialValues",
          "to": "count",
          "out": "error",
          "in": "error"
        }
      ],
      "nodes": [
        {
          "id": "output-2",
          "type": "output",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "type": "string",
                  "title": "context"
                },
                "json": {
                  "title": "json",
                  "description": "The validated JSON.",
                  "type": "string"
                }
              }
            }
          }
        },
        {
          "id": "assembleContext",
          "type": "invoke",
          "configuration": {
            "$board": "#assembleContext"
          }
        },
        {
          "id": "validate",
          "type": "validateJson",
          "configuration": {}
        },
        {
          "id": "buildContext",
          "type": "invoke",
          "configuration": {
            "$board": "#buildContext"
          }
        },
        {
          "id": "generate",
          "type": "text",
          "configuration": {
            "text": "unused"
          }
        },
        {
          "id": "input-1",
          "type": "input",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "schema": {
                  "title": "Schema",
                  "description": "The schema to convert to schemish.",
                  "type": "object",
                  "examples": [
                    "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"poems\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"inspiration\": {\n            \"type\": \"string\",\n            \"description\": \"The inspiration behind the poem\"\n          },\n          \"poem\": {\n            \"type\": \"string\",\n            \"description\": \"The poem itself\"\n          }\n        }\n      }\n    }\n  }\n}"
                  ],
                  "format": "multiline",
                  "default": "{}"
                },
                "context": {
                  "title": "Context",
                  "type": "array",
                  "behavior": [
                    "llm-content"
                  ],
                  "default": "[]",
                  "examples": [
                    "the universe within us"
                  ]
                },
                "instruction": {
                  "title": "Instruction",
                  "format": "multiline",
                  "examples": [
                    "You are a brilliant poet who specializes in two-line rhyming poems.\nGiven any topic, you can quickly whip up three two-line rhyming poems about it.\nLook at the topic below and do your magic"
                  ],
                  "type": "string"
                }
              },
              "required": [
                "instruction"
              ]
            }
          }
        },
        {
          "id": "count",
          "type": "invoke",
          "configuration": {
            "$board": "#count"
          }
        },
        {
          "id": "validationError",
          "type": "output",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "$error": {
                  "title": "$error",
                  "description": "The error if the JSON is invalid.",
                  "type": "object",
                  "properties": {
                    "kind": {
                      "type": "string",
                      "enum": [
                        "error"
                      ]
                    },
                    "error": {
                      "type": "object",
                      "properties": {
                        "type": {
                          "type": "string",
                          "enum": [
                            "parsing",
                            "validation"
                          ]
                        },
                        "message": {
                          "type": "string"
                        }
                      }
                    }
                  }
                },
                "context": {
                  "type": "string",
                  "title": "context"
                }
              }
            }
          }
        },
        {
          "id": "format",
          "type": "promptTemplate",
          "configuration": {
            "template": "Reply as valid JSON of the following format:\n\n```json\n{{schemish}}\n```\n"
          }
        },
        {
          "id": "schemish",
          "type": "schemish",
          "configuration": {}
        },
        {
          "id": "initialValues",
          "type": "passthrough",
          "configuration": {
            "count": 5,
            "error": "stub"
          }
        }
      ],
      "graphs": {
        "assembleContext": {
          "edges": [
            {
              "from": "assembleContext-input",
              "to": "assembleContext-run",
              "out": "*"
            },
            {
              "from": "assembleContext-run",
              "to": "assembleContext-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "assembleContext-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "assembleContext-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function assembleContext({context,json:json2}) {if(!context)throw new Error(\"Context is required\");return{context:[...context,{role:\"model\",parts:{text:JSON.stringify(json2)}}]}}",
                "name": "assembleContext",
                "raw": true
              }
            },
            {
              "id": "assembleContext-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "buildContext": {
          "edges": [
            {
              "from": "buildContext-input",
              "to": "buildContext-run",
              "out": "*"
            },
            {
              "from": "buildContext-run",
              "to": "buildContext-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "buildContext-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "buildContext-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function buildContext({context,format,instruction}) {if(!Array.isArray(context)){const text=typeof context===\"string\"?context:JSON.stringify(context);context=[{role:\"user\",parts:[{text}]}]}const list=context||[];if(list.length>0){const last=list[list.length-1];if(last.role===\"user\"){last.parts.unshift({text:instruction},{text:format});return{context:list}}}return{context:[...list,{role:\"user\",parts:[{text:instruction},{text:format}]}]}}",
                "name": "buildContext",
                "raw": true
              }
            },
            {
              "id": "buildContext-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "count": {
          "edges": [
            {
              "from": "count-input",
              "to": "count-run",
              "out": "*"
            },
            {
              "from": "count-run",
              "to": "count-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "count-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "count-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function count({context,error,count}) {const num=count-1;if(num!=0){return{continue:context,count:num}}return{stop:error}}",
                "name": "count",
                "raw": true
              }
            },
            {
              "id": "count-output",
              "type": "output",
              "configuration": {}
            }
          ]
        }
      }
    },
    "toolWorker": {
      "title": "Tool Worker",
      "description": "A worker that can use tools to accomplish tasks.",
      "version": "0.0.1",
      "edges": [
        {
          "from": "fn-7",
          "to": "fn-8",
          "out": "context",
          "in": "context"
        },
        {
          "from": "fn-7",
          "to": "fn-8",
          "out": "functionCall",
          "in": "functionCall"
        },
        {
          "from": "fn-7",
          "to": "fn-11",
          "out": "context",
          "in": "generated"
        },
        {
          "from": "fn-7",
          "to": "fn-11",
          "out": "functionCall",
          "in": "functionCall"
        },
        {
          "from": "fn-7",
          "to": "output-2",
          "out": "context",
          "in": "context"
        },
        {
          "from": "fn-7",
          "to": "output-2",
          "out": "text",
          "in": "text"
        },
        {
          "from": "text-6",
          "to": "fn-7",
          "out": "context",
          "in": "context"
        },
        {
          "from": "fn-8",
          "to": "invoke-9",
          "out": "*",
          "in": ""
        },
        {
          "from": "fn-11",
          "to": "text-12",
          "out": "context",
          "in": "context"
        },
        {
          "from": "fn-11",
          "to": "fn-13",
          "out": "context",
          "in": "context"
        },
        {
          "from": "fn-5",
          "to": "text-6",
          "out": "tools",
          "in": "tools"
        },
        {
          "from": "fn-5",
          "to": "fn-8",
          "out": "urlMap",
          "in": "urlMap"
        },
        {
          "from": "fn-5",
          "to": "text-12",
          "out": "tools",
          "in": "tools"
        },
        {
          "from": "fn-3",
          "to": "text-6",
          "out": "context",
          "in": "context"
        },
        {
          "from": "fn-3",
          "to": "fn-11",
          "out": "context",
          "in": "context"
        },
        {
          "from": "invoke-9",
          "to": "fn-10",
          "out": "*",
          "in": ""
        },
        {
          "from": "fn-10",
          "to": "fn-11",
          "out": "response",
          "in": "response"
        },
        {
          "from": "text-12",
          "to": "fn-13",
          "out": "context",
          "in": "generated"
        },
        {
          "from": "text-12",
          "to": "output-14",
          "out": "text",
          "in": "text"
        },
        {
          "from": "fn-13",
          "to": "output-14",
          "out": "context",
          "in": "context"
        },
        {
          "from": "map-4",
          "to": "fn-5",
          "out": "list",
          "in": "list"
        },
        {
          "from": "input-1",
          "to": "fn-3",
          "out": "context",
          "in": "context"
        },
        {
          "from": "input-1",
          "to": "fn-3",
          "out": "instruction",
          "in": "instruction"
        },
        {
          "from": "input-1",
          "to": "map-4",
          "out": "tools",
          "in": "list"
        }
      ],
      "nodes": [
        {
          "id": "output-2",
          "type": "output",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "type": "string",
                  "title": "context"
                },
                "text": {
                  "type": "string",
                  "title": "text"
                }
              }
            }
          }
        },
        {
          "id": "fn-7",
          "type": "invoke",
          "configuration": {
            "$board": "#fn-7"
          },
          "metadata": {
            "title": "Router"
          }
        },
        {
          "id": "text-6",
          "type": "text",
          "configuration": {
            "text": "unused"
          },
          "metadata": {
            "title": "Do Work"
          }
        },
        {
          "id": "fn-8",
          "type": "invoke",
          "configuration": {
            "$board": "#fn-8"
          },
          "metadata": {
            "title": "Assemble Board Invoke"
          }
        },
        {
          "id": "fn-11",
          "type": "invoke",
          "configuration": {
            "$board": "#fn-11"
          },
          "metadata": {
            "title": "Format Function Response"
          }
        },
        {
          "id": "fn-5",
          "type": "invoke",
          "configuration": {
            "$board": "#fn-5"
          },
          "metadata": {
            "title": "Format Function Declarations"
          }
        },
        {
          "id": "fn-3",
          "type": "invoke",
          "configuration": {
            "$board": "#fn-3"
          },
          "metadata": {
            "title": "Build Context"
          }
        },
        {
          "id": "invoke-9",
          "type": "invoke",
          "configuration": {},
          "metadata": {
            "title": "Invoke Board"
          }
        },
        {
          "id": "fn-10",
          "type": "invoke",
          "configuration": {
            "$board": "#fn-10"
          },
          "metadata": {
            "title": "Format Board Response"
          }
        },
        {
          "id": "text-12",
          "type": "text",
          "configuration": {
            "text": "unused"
          },
          "metadata": {
            "title": "Reply to Function"
          }
        },
        {
          "id": "fn-13",
          "type": "invoke",
          "configuration": {
            "$board": "#fn-13"
          },
          "metadata": {
            "title": "Assemble Context"
          }
        },
        {
          "id": "map-4",
          "type": "map",
          "configuration": {
            "board": {
              "kind": "board",
              "board": {
                "kits": [],
                "edges": [
                  {
                    "from": "getFunctionSignature",
                    "to": "output-2",
                    "out": "function",
                    "in": "function"
                  },
                  {
                    "from": "input-1",
                    "to": "fetch-3",
                    "out": "item",
                    "in": "url"
                  },
                  {
                    "from": "input-1",
                    "to": "output-2",
                    "out": "item",
                    "in": "boardURL"
                  },
                  {
                    "from": "fetch-3",
                    "to": "getFunctionSignature",
                    "out": "response",
                    "in": "json"
                  }
                ],
                "nodes": [
                  {
                    "id": "output-2",
                    "type": "output",
                    "configuration": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "function": {
                            "type": "object",
                            "title": "function"
                          },
                          "boardURL": {
                            "type": "string",
                            "title": "boardURL"
                          }
                        }
                      }
                    }
                  },
                  {
                    "id": "getFunctionSignature",
                    "type": "jsonata",
                    "configuration": {
                      "expression": "\n      (\n        $adjustType := function ($type) {\n            $type = \"object\" or $type = \"array\" ? \"string\" : $type\n        };\n\n        {\n        \"function\": {\n            \"name\": $replace(title, /\\W/, \"_\"),\n            \"description\": description,\n            \"parameters\": {\n                \"type\": \"object\",\n                \"properties\": nodes[type=\"input\"][0].configuration.schema.properties ~> $each(function($v, $k) {\n                { $k: {\n                    \"type\": $v.type ~> $adjustType,\n                    \"description\": $v.description\n                } }\n                }) ~> $merge\n            }\n        },\n        \"returns\": nodes[type=\"output\"][0].configuration.schema ~> | ** | {}, 'title' |\n        }\n    )",
                      "raw": true
                    }
                  },
                  {
                    "id": "input-1",
                    "type": "input",
                    "configuration": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "item": {
                            "title": "url",
                            "description": "The URL to fetch",
                            "type": "string"
                          }
                        },
                        "required": [
                          "item"
                        ]
                      }
                    }
                  },
                  {
                    "id": "fetch-3",
                    "type": "fetch",
                    "configuration": {}
                  }
                ],
                "graphs": {}
              }
            }
          },
          "metadata": {
            "title": "Turn Boards into Functions"
          }
        },
        {
          "id": "input-1",
          "type": "input",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "title": "Context",
                  "type": "array",
                  "behavior": [
                    "llm-content"
                  ],
                  "default": "What is the square root of e?"
                },
                "instruction": {
                  "title": "Instruction",
                  "format": "multiline",
                  "examples": [
                    "You are a hip, fun-loving mathematician who loves to help solve problems and chat about math. You also love finding answers to questions using Search. Use the right tool for solving the problems and reply without engaging tools otherwise. After using the tool, make sure to summarize and expand the answer in a hip, humorous way to help the user enjoy the beauty of math."
                  ],
                  "type": "string"
                },
                "tools": {
                  "title": "Tools",
                  "type": "array",
                  "description": "The list to iterate over.",
                  "behavior": [
                    "board"
                  ],
                  "examples": [
                    "[\"https://raw.githubusercontent.com/breadboard-ai/breadboard/b5577943bdd0956bed3874244b34ea80f1589eaa/packages/breadboard-web/public/graphs/search-summarize.json\",\"https://raw.githubusercontent.com/breadboard-ai/breadboard/b5577943bdd0956bed3874244b34ea80f1589eaa/packages/breadboard-web/public/graphs/math.json\"]"
                  ],
                  "default": "[]"
                }
              },
              "required": [
                "instruction"
              ]
            }
          }
        },
        {
          "id": "output-14",
          "type": "output",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "type": "string",
                  "title": "context"
                },
                "text": {
                  "type": "string",
                  "title": "Text",
                  "description": "The generated text"
                }
              }
            }
          },
          "metadata": {
            "title": "Function Call"
          }
        }
      ],
      "graphs": {
        "fn-7": {
          "edges": [
            {
              "from": "fn-7-input",
              "to": "fn-7-run",
              "out": "*"
            },
            {
              "from": "fn-7-run",
              "to": "fn-7-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "fn-7-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "fn-7-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function fn_7({context}) {if(!context)throw new Error(\"Context is a required input\");const item=context;const part=item.parts[0];console.assert(item.parts.length===1,\"Only one part is expected in Gemini response\");if(\"text\"in part){return{context,text:part.text}}return{context,functionCall:part.functionCall}}",
                "name": "fn_7",
                "raw": true
              }
            },
            {
              "id": "fn-7-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "fn-8": {
          "edges": [
            {
              "from": "fn-8-input",
              "to": "fn-8-run",
              "out": "*"
            },
            {
              "from": "fn-8-run",
              "to": "fn-8-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "fn-8-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "fn-8-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function fn_8({functionCall,urlMap}) {if(!functionCall)throw new Error(\"Function call is a required input\");if(!urlMap)throw new Error(\"URL map is a required input\");const call=functionCall;const $board=urlMap[call.name];const generator=\"https://raw.githubusercontent.com/breadboard-ai/breadboard/05136f811e443dd931a2a2a40ff5a3f388d5ce75/packages/breadboard-web/public/graphs/gemini-generator.json\";return{$board,generator,...call.args}}",
                "name": "fn_8",
                "raw": true
              }
            },
            {
              "id": "fn-8-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "fn-11": {
          "edges": [
            {
              "from": "fn-11-input",
              "to": "fn-11-run",
              "out": "*"
            },
            {
              "from": "fn-11-run",
              "to": "fn-11-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "fn-11-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "fn-11-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function fn_11({context,generated,functionCall,response}) {const call=functionCall;return{context:[...context,generated,{role:\"function\",parts:[{functionResponse:{name:call.name,response}}]}]}}",
                "name": "fn_11",
                "raw": true
              }
            },
            {
              "id": "fn-11-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "fn-5": {
          "edges": [
            {
              "from": "fn-5-input",
              "to": "fn-5-run",
              "out": "*"
            },
            {
              "from": "fn-5-run",
              "to": "fn-5-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "fn-5-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "fn-5-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function fn_5({list}) {const tools=[];const urlMap={};list.forEach(item=>{tools.push(item.function);urlMap[item.function.name]=item.boardURL});return{tools,urlMap}}",
                "name": "fn_5",
                "raw": true
              }
            },
            {
              "id": "fn-5-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "fn-3": {
          "edges": [
            {
              "from": "fn-3-input",
              "to": "fn-3-run",
              "out": "*"
            },
            {
              "from": "fn-3-run",
              "to": "fn-3-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "fn-3-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "fn-3-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function fn_3({context,instruction}) {if(typeof context===\"string\"){context=[{role:\"user\",parts:[{text:context}]}]}const list=context||[];if(list.length>0){const last=list[list.length-1];if(last.role===\"user\"){last.parts.unshift({text:instruction});return{context:list}}}return{context:[...list,{role:\"user\",parts:[{text:instruction}]}]}}",
                "name": "fn_3",
                "raw": true
              }
            },
            {
              "id": "fn-3-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "fn-10": {
          "edges": [
            {
              "from": "fn-10-input",
              "to": "fn-10-run",
              "out": "*"
            },
            {
              "from": "fn-10-run",
              "to": "fn-10-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "fn-10-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "fn-10-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function fn_10(inputs) {const{schema,...response}=inputs;schema;return{response}}",
                "name": "fn_10",
                "raw": true
              }
            },
            {
              "id": "fn-10-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "fn-13": {
          "edges": [
            {
              "from": "fn-13-input",
              "to": "fn-13-run",
              "out": "*"
            },
            {
              "from": "fn-13-run",
              "to": "fn-13-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "fn-13-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "fn-13-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function fn_13({context,generated}) {if(!context)throw new Error(\"Context is required\");return{context:[...context,generated]}}",
                "name": "fn_13",
                "raw": true
              }
            },
            {
              "id": "fn-13-output",
              "type": "output",
              "configuration": {}
            }
          ]
        }
      }
    },
    "worker": {
      "title": "Worker",
      "description": "The essential Agent building block",
      "version": "0.0.1",
      "edges": [
        {
          "from": "assembleContext",
          "to": "output-2",
          "out": "context",
          "in": "context"
        },
        {
          "from": "generate",
          "to": "assembleContext",
          "out": "context",
          "in": "generated"
        },
        {
          "from": "generate",
          "to": "output-2",
          "out": "text",
          "in": "text"
        },
        {
          "from": "buildContext",
          "to": "generate",
          "out": "context",
          "in": "context"
        },
        {
          "from": "buildContext",
          "to": "assembleContext",
          "out": "context",
          "in": "context"
        },
        {
          "from": "input-1",
          "to": "buildContext",
          "out": "context",
          "in": "context"
        },
        {
          "from": "input-1",
          "to": "buildContext",
          "out": "instruction",
          "in": "instruction"
        },
        {
          "from": "input-1",
          "to": "generate",
          "out": "stopSequences",
          "in": "stopSequences"
        }
      ],
      "nodes": [
        {
          "id": "output-2",
          "type": "output",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "type": "string",
                  "title": "context"
                },
                "text": {
                  "type": "string",
                  "title": "Output",
                  "description": "Agent's output"
                }
              }
            }
          }
        },
        {
          "id": "assembleContext",
          "type": "invoke",
          "configuration": {
            "$board": "#assembleContext"
          }
        },
        {
          "id": "generate",
          "type": "text",
          "configuration": {
            "text": "unused"
          }
        },
        {
          "id": "buildContext",
          "type": "invoke",
          "configuration": {
            "$board": "#buildContext"
          }
        },
        {
          "id": "input-1",
          "type": "input",
          "configuration": {
            "schema": {
              "type": "object",
              "properties": {
                "context": {
                  "title": "Context",
                  "type": "array",
                  "behavior": [
                    "llm-content"
                  ],
                  "examples": [
                    "the universe within us"
                  ]
                },
                "instruction": {
                  "title": "Instruction",
                  "format": "multiline",
                  "examples": [
                    "You are a brilliant poet who specializes in two-line rhyming poems.\nGiven any topic, you can quickly whip up a two-line rhyming poem about it.\nLook at the topic below and do your magic"
                  ],
                  "type": "string"
                },
                "stopSequences": {
                  "type": "array",
                  "title": "Stop Sequences",
                  "description": "An array of strings that will stop the output",
                  "items": {
                    "type": "string"
                  },
                  "default": "[]"
                }
              },
              "required": [
                "context",
                "instruction"
              ]
            }
          }
        }
      ],
      "graphs": {
        "assembleContext": {
          "edges": [
            {
              "from": "assembleContext-input",
              "to": "assembleContext-run",
              "out": "*"
            },
            {
              "from": "assembleContext-run",
              "to": "assembleContext-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "assembleContext-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "assembleContext-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function assembleContext({context,generated}) {if(!context)throw new Error(\"Context is required\");return{context:[...context,generated]}}",
                "name": "assembleContext",
                "raw": true
              }
            },
            {
              "id": "assembleContext-output",
              "type": "output",
              "configuration": {}
            }
          ]
        },
        "buildContext": {
          "edges": [
            {
              "from": "buildContext-input",
              "to": "buildContext-run",
              "out": "*"
            },
            {
              "from": "buildContext-run",
              "to": "buildContext-output",
              "out": "*"
            }
          ],
          "nodes": [
            {
              "id": "buildContext-input",
              "type": "input",
              "configuration": {}
            },
            {
              "id": "buildContext-run",
              "type": "runJavascript",
              "configuration": {
                "code": "function buildContext({context,instruction}) {if(typeof context===\"string\"){context=[{role:\"user\",parts:[{text:context}]}]}const list=context||[];if(list.length>0){const last=list[list.length-1];if(last.role===\"user\"){last.parts.unshift({text:instruction});return{context:list}}}return{context:[...list,{role:\"user\",parts:[{text:instruction}]}]}}",
                "name": "buildContext",
                "raw": true
              }
            },
            {
              "id": "buildContext-output",
              "type": "output",
              "configuration": {}
            }
          ]
        }
      }
    }
  }
}